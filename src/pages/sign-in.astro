---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div
    style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #000;"
  >
    <div id="clerk-sign-in"></div>
  </div>
</Layout>

<script>
  async function initSignIn() {
    try {
      const container = document.getElementById("clerk-sign-in");
      if (!container) {
        console.error("Sign-in container not found");
        return;
      }

      // Wait for Clerk to be available
      let attempts = 0;
      const maxAttempts = 100; // Increased attempts

      const checkClerk = () => {
        // Try different Clerk API patterns
        if (window.Clerk) {
          // Method 1: Try mountSignIn directly
          if (typeof window.Clerk.mountSignIn === "function") {
            console.log("Using Clerk.mountSignIn()");
            window.Clerk.mountSignIn(container, {
              routing: "path",
              path: "/sign-in",
              signUpUrl: "/sign-up",
            });
            return;
          }

          // Method 2: Try components API
          if (
            window.Clerk.components &&
            window.Clerk.components.signIn &&
            typeof window.Clerk.components.signIn.mount === "function"
          ) {
            console.log("Using Clerk.components.signIn.mount()");
            window.Clerk.components.signIn.mount(container, {
              routing: "path",
              path: "/sign-in",
              signUpUrl: "/sign-up",
            });
            return;
          }

          // Method 3: Try load() then mount
          if (typeof window.Clerk.load === "function") {
            console.log("Clerk.load() available, loading...");
            window.Clerk.load().then(() => {
              if (window.Clerk.mountSignIn) {
                window.Clerk.mountSignIn(container, {
                  routing: "path",
                  path: "/sign-in",
                  signUpUrl: "/sign-up",
                });
              }
            });
            return;
          }

          // Log what's available for debugging
          console.log("Clerk available but components not ready:", {
            hasClerk: !!window.Clerk,
            hasComponents: !!window.Clerk.components,
            hasMountSignIn: typeof window.Clerk.mountSignIn === "function",
            clerkKeys: Object.keys(window.Clerk || {}),
          });
        }

        // Retry if not ready
        if (attempts < maxAttempts) {
          attempts++;
          setTimeout(checkClerk, 100);
        } else {
          console.warn("Clerk sign-in component not available after", maxAttempts, "attempts");
          console.log("Available Clerk properties:", Object.keys(window.Clerk || {}));
        }
      };

      // Listen for clerk-loaded event
      window.addEventListener("clerk-loaded", () => {
        console.log("Clerk loaded event received");
        checkClerk();
      });

      // Start checking
      checkClerk();
    } catch (error) {
      console.error("Error initializing Clerk sign-in:", error);
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initSignIn);
  } else {
    initSignIn();
  }
</script>
