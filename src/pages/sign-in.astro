---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div
    style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #000;"
  >
    <div id="clerk-sign-in"></div>
  </div>
</Layout>

<script>
  function initSignIn() {
    const container = document.getElementById("clerk-sign-in");
    if (!container) {
      console.error("Sign-in container not found");
      return;
    }

    function mountClerk() {
      if (window.Clerk && window.Clerk.mountSignIn) {
        try {
          window.Clerk.mountSignIn(container, {
            routing: "path",
            path: "/sign-in",
            signUpUrl: "/sign-up",
          });
          console.log("Clerk sign-in mounted successfully");
        } catch (error) {
          console.error("Error mounting Clerk sign-in:", error);
        }
        return true;
      }
      return false;
    }

    // Try to mount immediately if Clerk is already available
    if (mountClerk()) {
      return;
    }

    // Listen for clerk-loaded event from Layout
    window.addEventListener("clerk-loaded", () => {
      console.log("Clerk loaded event received");
      mountClerk();
    });

    // Fallback: poll for Clerk availability
    let attempts = 0;
    const maxAttempts = 50;
    const checkInterval = setInterval(() => {
      attempts++;
      if (mountClerk() || attempts >= maxAttempts) {
        clearInterval(checkInterval);
        if (attempts >= maxAttempts) {
          console.warn("Clerk sign-in component not available after", maxAttempts, "attempts");
        }
      }
    }, 100);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initSignIn);
  } else {
    initSignIn();
  }
</script>
